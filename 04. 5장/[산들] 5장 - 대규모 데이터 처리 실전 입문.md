# 5장 - 대규모 데이터 처리 실전 입문

대량의 데이터에 액세스하는 경우에 대해 알아보자.

# 14강 - 용도특화형 인덱싱

대규모 데이터를 능수능란하게 다루기

## 인덱스와 시스템 구성 - RDBMS의 한계가 보일 때

전문 검색이나 유사문서계열 탐색, 데이터마이닝 등 대규모 데이터를 다루는 경우 **RDBMS로는 한계**가 있다. 이럴 때 배치 처리로 RDBMS에서 데이터를 추출해서 별도의 인덱스 서버와 같은 것을 만들고, 이 인덱스 서버에 웹 애플리케이션에서 **RPC** 등으로 액세스하는 방법을 사용한다.

### RPC, 웹 API

![image.png](5%E1%84%8C%E1%85%A1%E1%86%BC%20-%20%E1%84%83%E1%85%A2%E1%84%80%E1%85%B2%E1%84%86%E1%85%A9%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%86%E1%85%AE%E1%86%AB%201cd43171511780cb9418e7b56c367b87/image.png)

1. DB에 있는 데이터를 정기적으로 인덱스 서버로 넘긴다.
2. 인덱스 서버에서 역 인덱스를 만든다.
3. AP 서버는 RPC를 이용해서 인덱스 서버에 접근한다.

AP서버에는 메모리가 충분하지 않은 경우가 많고, 검색 인덱스를 여러 프로세스에서 같이 사용하도록 구성하는 것은 적합치 않기 때문에 직접 인덱스를 저장하지 않고 인덱스 서버를 이용한다. 하테나 검색 서버도 이런 방식으로 인덱스를 만들고 있다. 

![image.png](5%E1%84%8C%E1%85%A1%E1%86%BC%20-%20%E1%84%83%E1%85%A2%E1%84%80%E1%85%B2%E1%84%86%E1%85%A9%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%86%E1%85%AE%E1%86%AB%201cd43171511780cb9418e7b56c367b87/image%201.png)

요즘(?)에는 RPC보다 웹 API로 처리하는 일이 더 많다.

## 용도특화형 인덱싱 - 튜닝한 데이터 구조 사용하기

위와 같은 방법을 하테나에서는 ‘용도특화형 인덱싱’이라고 한다. 용도특화형 인덱싱을 하면 RDBMS에서는 어려운 일이 가능해진다. RDBMS는 범용적인 용도로 만들어졌기 때문에 특정한 목적으로만 사용하고자 할 때는 용도특화형 인덱싱이 압도적으로 빠르다. 

검색에서 역 인덱스가 전형적인 예로, 자연어처리 인덱스를 만들어두면 RDBMS로 데이터를 전부 순회하지 않아도 순식간에 검색할 수 있다.

### [예] 하테나 키워드에 의한 링크

![image.png](5%E1%84%8C%E1%85%A1%E1%86%BC%20-%20%E1%84%83%E1%85%A2%E1%84%80%E1%85%B2%E1%84%86%E1%85%A9%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%86%E1%85%AE%E1%86%AB%201cd43171511780cb9418e7b56c367b87/image%202.png)

용도특화형 인덱싱의 다른 사례로 하테나 키워드에서 키워드 링크를 살펴보자.

특정 문서가 20만 이상의 키워드 중에 무엇을 포함하는지를 찾아야할 때 일일이 DB에 있는 키워드 목록과 사용자가 작성한 내용을 맞춰보면 DB에 과부하가 걸린다. 

그래서 배치 처리로 20만 건의 키워드를 추출해둔다. 예전에는 이로부터 굉장히 거대한 정규표현을 만들었다. 10만 건의 정규표현이 들어간 거대한 파이을 만들어서 이를 메모리에 읽어들인 후 매칭했다. 정규표현은 or로 연결하면 계산량이 너무 커지는 단점이 있었다. 현재는 Trie 기반의 정규표현을 사용해서 **Common Prefix Search(공통접두사검색)**를 수행한다.

공통접두사검색을 할 때는 다양한 알고리즘/데이터 구조가 있다. 이 알고리즘의 데이터 구조를 DB에서 사전에 추출해서 만들어두고 매칭하는 것이 키워드 링크의 방법이다.

### [예] 하테나 북마크의 텍스트 분류기

![image.png](5%E1%84%8C%E1%85%A1%E1%86%BC%20-%20%E1%84%83%E1%85%A2%E1%84%80%E1%85%B2%E1%84%86%E1%85%A9%20%E1%84%83%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%90%E1%85%A5%20%E1%84%8E%E1%85%A5%E1%84%85%E1%85%B5%20%E1%84%89%E1%85%B5%E1%86%AF%E1%84%8C%E1%85%A5%E1%86%AB%20%E1%84%8B%E1%85%B5%E1%86%B8%E1%84%86%E1%85%AE%E1%86%AB%201cd43171511780cb9418e7b56c367b87/image%203.png)

하테나 북마크의 카테고리도 좋은 예다. 하테나 북마크는 ‘과학, 학문’이나 ‘컴퓨터, IT’등 기사의 카테고리를 자동분류하고 있다.

**Complement Naive Bayes** 알고리즘을 사용해서 자동으로 기계학습을 통해 분류한다. 이 알고리즘을 사용할 때는 문서에 포함된 단어의 출현확률이 필요하다. 출현확률, 실제로는 출현빈도만을 저장하는 서버를 가동해둔다. 이 서버에 질의하면 순식간에 응답이 반환된다.

### 전문 검색엔진

전문 검색엔진은 대량의 데이터에서 빠른 검색이 가능하고 '좋은 느낌(Feeling Lucky)'과 같은 **관련성 높은 결과를 상위에** 표시할 수 있다. 이를 위해 ‘**스코어링**’ 처리를 한다. 스코어링에서는 검색대상인 문서가 가지고 있는 다양한 정보를 복합적으로 이용한다. 특정 컬럼으로만 정렬할 수 있는 RDBMS에서는 무리다.

전문 검색엔진의 특징은 대량의 데이터에서 사용자가 원하는 정보를 빠르고 정확하게 찾아내는 데 큰 도움이 된다.

# 15강 이론과 실전 양쪽과의 싸움

## 요구되는 기술적 요건 규명하기

웹 애플리케이션 세계에서는 **이론과 실전** 양쪽의 접근이 모두 중요하다. 

- 실전
    
    예를 들어, RDBMS에서 JOIN을 사용하지 않는 방식은 실전에서 나온 '배드 노하우'로 여겨질 수 있는데, 이는 RDBMS의 근본적인 개념과 충돌하기 때문이다. ‘대용량의 데이터를 효율적으로 다루기 위해서 JOIN을 사용하지 않는다’는 조언은 교과서가 아닌 실무 현장에서 나온 **실전적 지식**이다.
    
- 이론
    
    역 인덱스의 스코어 계산과 같은 작업은 벡터공간모델과 같은 전통적인 이론을 통해 쉽게 해결할 수 있으며, 이는 교과서에서 배울 수 있는 내용이다. 실제로 많은 문제들이 이러한 고전적인 이론적 접근으로 해결 가능하다. 
    

### 대규모 웹 애플리케이션에 있어서 이론과 실전

이론만 강조하면 실제 구현에 어려움을 겪고, 실전만 강조하면 대규모 데이터 처리에 한계가 있다.

초기에 하테나는 실전 중심의 접근 방식을 취했다. 서비스가 성장하면서 기존의 실전적 노하우만으로는 한계에 도달했다. 규모가 커지고 문제가 본질적으로 변화하면서 단순한 테크닉으로 해결 불가능했다. 결국 고전적이지만 본질적인 '이론'의 중요성을 깨달았다.

서비스의 성장 단계에 따라 적절한 균형을 맞추는 것이 중요하다.

### 컴퓨터의 문제에 이르는 길을 어떻게 발견할까?

문제 해결 과정에서 이론적 지식의 실제 적용에 대해 설명한다.

문제 해결의 핵심은 실제 문제를 컴퓨터가 해결할 수 있는 형태로 전환하는 능력이다. 일단 적절한 해결 방법을 찾으면, 나머지는 엔지니어링의 영역이 된다.

앞서 살펴본대로 하테나 키워드에서 '키워드로 링크하기'라는 요구사항을 Double Array Trie와 Common Prefix Search 알고리즘으로 해결했다. 처음에는 이 해결책을 알지 못했고, 인터넷을 통해 학습하여 발견했다.

결국, 알고리즘과 데이터 구조의 활용 가능성을 미리 알고 있어야 한다. 단순히 이론적 지식을 습득하는 것을 넘어서 실제 응용을 위한 직관과 이해가 필요하다.